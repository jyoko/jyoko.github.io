<!doctype html><html class="theme-next use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2"><meta name="description" content="If you&apos;re not comfortable with how reduce generically combines values in a list, check out Reduce All the Things! first.Hopefully you&apos;re now comfortable with how reduce works, but maybe not grokking h"><meta property="og:type" content="article"><meta property="og:title" content="Reduce All the Things! (part 2)"><meta property="og:url" content="http://jyoko.github.io/2015/11/8/reduce-all-the-things-part2/index.html"><meta property="og:site_name" content="jrandm thoughts"><meta property="og:description" content="If you&apos;re not comfortable with how reduce generically combines values in a list, check out Reduce All the Things! first.Hopefully you&apos;re now comfortable with how reduce works, but maybe not grokking h"><meta property="og:updated_time" content="2016-02-16T21:39:21.521Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Reduce All the Things! (part 2)"><meta name="twitter:description" content="If you&apos;re not comfortable with how reduce generically combines values in a list, check out Reduce All the Things! first.Hopefully you&apos;re now comfortable with how reduce works, but maybe not grokking h"><script type="text/javascript" id="hexo.configuration">var CONFIG={scheme:"Mist",sidebar:"remove",motion:!0};</script><title>Reduce All the Things! (part 2) | jrandm thoughts</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><!--[if lte IE 8]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div><![endif]--><div class="container one-column page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">jrandm thoughts</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Whatever crosses my mind</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-home fa-fw"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-th fa-fw"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-user fa-fw"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-archive fa-fw"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">Reduce All the Things! (part 2)</h1><div class="post-meta"><span class="post-time">Posted on <time itemprop="dateCreated" datetime="2015-11-08T03:00:00-05:00" content="2015-11-08">2015-11-08</time></span> <span class="post-category">&nbsp; | &nbsp; In <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/learn2code/" itemprop="url" rel="index"><span itemprop="name">Learn2Code</span></a></span></span></div></header><div class="post-body"><span itemprop="articleBody"><p>If you're not comfortable with how reduce generically combines values in a list, check out <a href="/2015/11/8/reduce-all-the-things/">Reduce All the Things!</a> first.</p><p>Hopefully you're now comfortable with how reduce works, but maybe not grokking how to implement it diferently, or how to approach solving problems with reduce. This post is split into two logical parts: First I'm going to include a few different approaches to how you might write a reduce function, then we'll explore ways to apply reduce to actual problems.</p><p>Going into these different solutions, I intentionally mixed up conditional checks and variable names; you want to focus on what's happening rather than memorizing any particular implementation.</p><h2>Imperative</h2><p>This implementation is basically what we wrote in the first post, but accounting for the optional starting value.</p><figure class="highlight js"><figcaption><span>Imperative Reduce</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imperativeReduce</span>(<span class="params">collection, accumulator, startValue</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> startIndex = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (startValue===<span class="literal">undefined</span>) &#123;</span><br><span class="line">    startValue = collection[<span class="number">0</span>];</span><br><span class="line">    startIndex = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i=startIndex,len=collection.length; i&lt;len; i++) &#123;</span><br><span class="line">    startValue = accumulator(startValue,collection[i]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> startValue;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>As you can see, other than modifying the starting index and accounting for a starting value, there's no real change.</p><h2>First Declarative</h2><p>I'm going to refer to the more functional approaches as declarative. Basically it just means I'm not using a direct loop, but rather a function that iterates for me.</p><figure class="highlight js"><figcaption><span>First Declarative Reduce</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decReduce1</span>(<span class="params">list, operation, start</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  start      = <span class="built_in">arguments</span>.length&gt;<span class="number">2</span> ? start  : list[<span class="number">0</span>];</span><br><span class="line">  list       = <span class="built_in">arguments</span>.length&gt;<span class="number">2</span> ? list   : list.slice(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  list.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    start = operation(start,value);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> start;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>This one uses basically the same logic as the imperative version, but we have to account for iterating differently. Rather than modifying the starting index, we have to change the <code>list</code> itself - in this case, we reset the variable to be a <code>slice</code> starting from the 1st index to avoid mutating the original array (do you know what <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions" target="_blank" rel="external">'passed by reference'</a> means?).</p><h2>Second Declarative</h2><p>This time we mix up the logic a bit - can you think of any downsides to this approach?</p><figure class="highlight js"><figcaption><span>Second Declarative Reduce</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decReduce2</span>(<span class="params">arr, combiner, init</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> iterator = <span class="function"><span class="keyword">function</span>(<span class="params">item, index, array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (init!==<span class="literal">undefined</span>) &#123;</span><br><span class="line">      init = combiner(init, item);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      init = item;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  collection.forEach(iterator);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> init;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>One big thing should jump out at you - we only have logic inside of the <code>iterator</code> function being called by <code>forEach</code>. While this will normally work, there are a few downsides to this method. One is the overhead of doing the conditional check on every iteration. The performance hit from this should be minimal, but at millions or billions of iterations we could expect to see a difference. Another is that if the given <code>combiner</code> function ever returns <code>undefined</code>, we will probably get unexpected output. You could argue that the given function <em>shouldn't</em> ever return <code>undefined</code>, and I'd agree with that, but it is something to consider if you're writing library functions (meaning functions intended for use by other programmers).</p><h2>Recursive</h2><p>If you're familiar with recursion, you can probably imagine there's at least 2 ways to write reduce this way. Let's take a look:</p><figure class="highlight js"><figcaption><span>Recursive Reduces</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pureRecurReduce</span>(<span class="params">list, mix, start</span>) </span>&#123;</span><br><span class="line">  list = list.slice();</span><br><span class="line">  <span class="keyword">if</span> (list.length===<span class="number">0</span>) <span class="keyword">return</span> start;</span><br><span class="line">  <span class="keyword">if</span> (start===<span class="literal">undefined</span>) start = list.shift();</span><br><span class="line">  <span class="keyword">return</span> mix(start, pureRecurReduce(list.slice(<span class="number">1</span>),mix,list[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iterRecurReduce</span>(<span class="params">list, mix, start</span>) </span>&#123;</span><br><span class="line">  list = list.slice();</span><br><span class="line">  <span class="keyword">if</span> (list.length===<span class="number">0</span>) <span class="keyword">return</span> start;</span><br><span class="line">  <span class="keyword">if</span> (start===<span class="literal">undefined</span>) start = list.shift();</span><br><span class="line">  <span class="keyword">return</span> iterRecurReduce(list.slice(<span class="number">1</span>), mix, mix(start,list[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>They're deceptively similar. The first will always inflate the call stack, as every return statement has to wait until the <code>pureRecurReduce</code> function hits the base case to finish executing the <code>mix</code> function. The second could be tail-optimized, as it returns a call to the same function with modified arguments.</p><h2>No Loops or Recursion!</h2><p>And finally, we have an academic exercise - how do you iterate without some kind of a loop or recursion? You could use <code>eval</code> in Javascript, or do some sort of parent-child message passing, or in a low-level language manipulate the stack directly. I did none of these, but implemented it using something called the Y-Combinator:</p><figure class="highlight js"><figcaption><span>Y-Combinator Reduce</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reduce = <span class="function"><span class="keyword">function</span>(<span class="params">g,o,l</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">F</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> F(<span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123; <span class="keyword">return</span> (x(x))(y);&#125;);</span><br><span class="line">    &#125;)(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> F(<span class="function"><span class="keyword">function</span>(<span class="params">y</span>) </span>&#123; <span class="keyword">return</span> (x(x))(y);&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)(<span class="function"><span class="keyword">function</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arr,cb,acc</span>) </span>&#123;</span><br><span class="line">      acc = (acc===<span class="literal">undefined</span>)?arr.shift():acc;</span><br><span class="line">      <span class="keyword">if</span> (arr.length===<span class="number">1</span>) <span class="keyword">return</span> o(acc,arr[<span class="number">0</span>]);</span><br><span class="line">      <span class="keyword">return</span> o(acc,r(arr));</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)(g,o,l);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// more concisely:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> reduce =</span><br><span class="line">(g,o,l)=&gt;(f=&gt;(x=&gt;f(y=&gt;x(x)(y)))(x=&gt;f(y=&gt;x(x)(y))))(r=&gt;(a,s=a.shift())=&gt;(a.length&lt;<span class="number">2</span>&amp;&amp;o(s,...a))||o(s,r(a)))([...g],l)</span><br></pre></td></tr></table></figure><p>This is, of course, mostly useless. Please don't write code this way. If you're interested in how I shrunk the first function to one (long) long, look for a future post on code golf!</p><h2>Application</h2><p>Great, so you get how <code>reduce</code> works, you can write it several ways, you're dreaming in folded numbers; what the hell is the point? Programming at its core is thinking in abstractions. Abstractly, this reduce function you now know so well takes a series of things and condenses it into one thing. Any time you have a list of some kind and want that changed to something else, you can use reduce.</p><p>What's a practical example? You're writing code for a game site, where you get long lists of games and the outcomes. We can think of it as a long string like so:</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WWWWLLLLTTTTWWWLLWWWWLLLLLTTTTLLLLWWWWWW</span><br></pre></td></tr></table></figure><p>Basically a stream of <strong>W</strong>ins, <strong>L</strong>osses, and <strong>T</strong>ies. If we wanted to get a player's record at that moment, we basically want to <em>reduce</em> those characters into a count object, right? That might look something like this:</p><figure class="highlight js"><figcaption><span>Calculate Record From String</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> recordStr = <span class="string">'WWWWLLLLTTTTWWWLLWWWWLLLLLTTTTLLLLWWWWWW'</span>;</span><br><span class="line"><span class="keyword">var</span> recordObj = recordStr.split(<span class="string">''</span>).reduce(<span class="function"><span class="keyword">function</span>(<span class="params">growing, current</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (current === <span class="string">'W'</span>) &#123;</span><br><span class="line">    growing.wins++;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (current === <span class="string">'L'</span>) &#123;</span><br><span class="line">    growing.losses++;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (current === <span class="string">'T'</span>) &#123;</span><br><span class="line">    growing.ties++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> growing;</span><br><span class="line">&#125;, &#123;wins:<span class="number">0</span>,losses:<span class="number">0</span>,ties:<span class="number">0</span>&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(recordObj); <span class="comment">// &#123; wins: 17, losses: 15, ties: 8 &#125;</span></span><br></pre></td></tr></table></figure><p>Notice a few important things here - the callback we pass in takes two values, we know this from the implementation. Remember, you the programmer <em>always</em> know what the first argument is. We define it in the starting value (the object we pass in with 0 for all the values we're counting), then by returning a value inside of the callback. That first value is the one we build upon. It's often called <code>accumulating</code> or <code>growing</code> to signify that, while the second argument is the current item you're combining.</p><p>The types don't have to be similar. In the next example, imagine you're part of an engineering team building an assembly line for some mechanical component. The team has dozens of tests that return various numbers, representing a component's variance from a given tolerance. Every test needs to be within <code>0.3</code> of the original to pass the inspection, otherwise it fails and needs to be scrapped. This is also a good reduce problem:</p><figure class="highlight js"><figcaption><span>Tolerance Test</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an array of multiple test objects</span></span><br><span class="line"><span class="keyword">var</span> firstBuild  = [<span class="number">0.2</span>,<span class="number">0.1</span>,-<span class="number">0.29</span>,-<span class="number">0.11</span>,<span class="number">0.2</span>,<span class="number">0.123</span>,<span class="number">0.02</span>,<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> secondBuild = [<span class="number">0.2</span>,<span class="number">0.1</span>,-<span class="number">0.29</span>,-<span class="number">0.27</span>,<span class="number">0.01</span>,<span class="number">0.103</span>,<span class="number">0.08</span>,<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> thirdBuild  = [<span class="number">0.2</span>,<span class="number">0.31</span>,-<span class="number">0.22</span>,-<span class="number">0.31</span>,<span class="number">0.2</span>,<span class="number">0.223</span>,<span class="number">0.01</span>,<span class="number">0</span>];</span><br><span class="line"><span class="keyword">var</span> testResults = [firstBuild, secondBuild, thirdBuild];</span><br><span class="line"></span><br><span class="line"><span class="comment">// We would actually use TWO helpers here - first a map,</span></span><br><span class="line"><span class="comment">// as we want a 1-to-1 match between a pass/fail for each</span></span><br><span class="line"><span class="comment">// item in the testResults array, then a reduce to change</span></span><br><span class="line"><span class="comment">// the numbered results to a single Boolean</span></span><br><span class="line"><span class="keyword">var</span> passFailArray = testResults.map(<span class="function"><span class="keyword">function</span>(<span class="params">testArray</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> testArray.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">passing, current</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (current &lt; -<span class="number">0.3</span> || current &gt; <span class="number">0.3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> passing;</span><br><span class="line">  &#125;, <span class="literal">true</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(passFailArray); <span class="comment">// [ true, true, false ]</span></span><br></pre></td></tr></table></figure><p>Why does this work? Here it's a logic puzzle - we assume the component passes all the tests by starting at true. If any test results are outside of our given tolerance (more than 0.3 away from 0), we return false. This flips the value of <code>passing</code> from true to false, and so the ultimate value will have to be false. Remember that the first argument in each subsequent call to our accumulating function is the return value of the previous one (after the start value), meaning all we have to do to change the result is return a different value. Otherwise, we want to continue returning our starting value of true.</p><p>Hopefully those examples help get you thinking about how to apply a reduce function in your own programming. If you have any questions or better examples, let me know! You can <a href="https://github.com/jyoko/jyoko.github.io" target="_blank" rel="external">file an issue against the blog</a>.</p></span></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2015/11/7/reduce-all-the-things/" rel="next" title="Reduce All the Things!"><i class="fa fa-chevron-left"></i> Reduce All the Things!</a></div><div class="post-nav-prev post-nav-item"><a href="/2015/11/17/lets-talk-recursion/" rel="prev" title="Let's Talk Recursion">Let's Talk Recursion <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2016</span> <span class="with-love"><i class="icon-next-heart fa fa-beer"></i></span> <span class="author" itemprop="copyrightHolder">jyoko</span></div><div class="powered-by">Powered by <a class="theme-link" href="http://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"></div></div><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script><script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script><script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script><script type="text/javascript" id="sidebar.toc.highlight">$(document).ready(function(){function o(){$(s+" "+r).removeClass(r.substring(1))}function t(){i(),n()}function i(){var o=$(".sidebar").height()-a.position().top-$(".post-toc-indicator-bottom").height();return a.css("height",o),o}function n(){c(".post-toc-indicator-top",a.scrollTop()>0?"show":"hide"),c(".post-toc-indicator-bottom",a.scrollTop()>=a.find("ol").height()-a.height()?"hide":"show")}function e(o){o.on("mousewheel DOMMouseScroll",function(o){var t=o.originalEvent,i=t.wheelDelta||-t.detail;this.scrollTop+=30*(0>i?1:-1),o.preventDefault(),n()})}function c(o,t){var i=$(o),n="show"===t?1:0;i.velocity?i.velocity("stop").velocity({opacity:n},{duration:100}):i.stop().animate({opacity:n},100)}var s=".post-toc",a=$(s),r=".active-current";a.on("activate.bs.scrollspy",function(){var t=$(s+" .active").last();o(),t.addClass("active-current"),a[0].scrollTop=t.position().top}).on("clear.bs.scrollspy",function(){o()}),$(document).on("sidebar.motion.complete",function(){t()}),$("body").scrollspy({target:s}),$(window).on("resize",function(){$(".sidebar").hasClass("sidebar-active")&&t()}),e(a)});</script><script type="text/javascript" id="sidebar.nav">$(document).ready(function(){var t=$("html"),i=200,a=$.isFunction(t.velocity);$(".sidebar-nav li").on("click",function(){var t=$(this),o="sidebar-nav-active",e="sidebar-panel-active";if(!t.hasClass(o)){var s=$("."+e),n=$("."+t.data("target"));a?s.velocity("transition.slideUpOut",i,function(){n.velocity("stop").velocity("transition.slideDownIn",i).addClass(e)}):s.animate({opacity:0},i,function(){s.hide(),n.stop().css({opacity:0,display:"block"}).animate({opacity:1},i,function(){s.removeClass(e),n.addClass(e)})}),t.siblings().removeClass(o),t.addClass(o)}}),$(".post-toc a").on("click",function(i){i.preventDefault();var o=escapeSelector(this.getAttribute("href")),e=$(o).offset().top;a?t.velocity("stop").velocity("scroll",{offset:e+"px",mobileHA:!1}):$("html, body").stop().animate({scrollTop:e},500)}),motionMiddleWares.sidebar=function(){var t=$(".post-toc-content");"post"===CONFIG.sidebar&&t.length>0&&t.html().trim().length>0&&displaySidebar()}});</script><script type="text/javascript" src="/js/bootstrap.js"></script></body></html>