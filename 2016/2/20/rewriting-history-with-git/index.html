<!doctype html><html class="theme-next use-motion"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css"><link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css"><meta name="keywords" content="Hexo, NexT"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2"><meta name="description" content="The running joke among programmers is that barely anyone understands how to use git. While that can seem painfully true sometimes, I don&apos;t think the problem is actually that people don&apos;t understand gi"><meta property="og:type" content="article"><meta property="og:title" content="Rewriting History With Git"><meta property="og:url" content="http://jyoko.github.io/2016/2/20/rewriting-history-with-git/index.html"><meta property="og:site_name" content="jrandm thoughts"><meta property="og:description" content="The running joke among programmers is that barely anyone understands how to use git. While that can seem painfully true sometimes, I don&apos;t think the problem is actually that people don&apos;t understand gi"><meta property="og:updated_time" content="2016-02-25T08:06:50.111Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Rewriting History With Git"><meta name="twitter:description" content="The running joke among programmers is that barely anyone understands how to use git. While that can seem painfully true sometimes, I don&apos;t think the problem is actually that people don&apos;t understand gi"><script type="text/javascript" id="hexo.configuration">var CONFIG={scheme:"Mist",sidebar:"remove",motion:!0};</script><title>Rewriting History With Git | jrandm thoughts</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><!--[if lte IE 8]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div><![endif]--><div class="container one-column page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">jrandm thoughts</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">Whatever crosses my mind</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-home fa-fw"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-th fa-fw"></i><br>Categories</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-user fa-fw"></i><br>About</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-archive fa-fw"></i><br>Archives</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><header class="post-header"><h1 class="post-title" itemprop="name headline">Rewriting History With Git</h1><div class="post-meta"><span class="post-time">Posted on <time itemprop="dateCreated" datetime="2016-02-20T03:00:00-05:00" content="2016-02-20">2016-02-20</time></span> <span class="post-category">&nbsp; | &nbsp; In <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">Programming</span></a></span></span></div></header><div class="post-body"><span itemprop="articleBody"><p>The <a href="https://xkcd.com/1597/" target="_blank" rel="external">running joke</a> among programmers is that barely anyone understands how to use git. While that can seem painfully true sometimes, I don't think the problem is actually that people don't <em>understand</em> git, but that it seems scary. Here's some not-scary and hopefully helpful tips.</p><p>Specifically, I'm going to be talking about rebasing. Most people who have used git will have collaborated with other people, so hopefully you're basically familiar with what rebasing is.</p><p>If not, think about those graphs you've seen in every git guide. A merge makes those side-by-side lines where one points back into the main branch (the merge commit), a rebase rewrites the commits to all be stacked on one line. Pretty simple, right?</p><p>Rebasing essentially <em>rewrites history</em>. If you've only ever rebased to stay up-to-date with your shared repo, you're missing out on why so many people love the command: The interactive rebase. All you have to do is:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -<span class="built_in">i</span></span><br></pre></td></tr></table></figure><p>The <code>-i</code> is key. If you really want to go nuts, pop open a repo you've been using (preferably one without too many commits), and try:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase -<span class="tag">i</span> --root</span><br></pre></td></tr></table></figure><p>You should be familiar with that screen; it's basically the commit message. The difference here is that there's individual commits listed with a word in front. At the bottom there's a helpful message:</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Commands:</span></span><br><span class="line"><span class="preprocessor">#  p, pick = use commit</span></span><br><span class="line"><span class="preprocessor">#  r, reword = use commit, but edit the commit message</span></span><br><span class="line"><span class="preprocessor">#  e, edit = use commit, but stop for amending</span></span><br><span class="line"><span class="preprocessor">#  s, squash = use commit, but meld into previous commit</span></span><br><span class="line"><span class="preprocessor">#  f, fixup = like "squash", but discard this commit's log message</span></span><br><span class="line"><span class="preprocessor">#  x, exec = run command (the rest of the line) using shell</span></span><br><span class="line"><span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># These lines can be re-ordered; they are executed from top to bottom.</span></span><br><span class="line"><span class="preprocessor">#</span></span><br><span class="line"><span class="preprocessor"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span><br><span class="line"><span class="preprocessor">#</span></span><br></pre></td></tr></table></figure><p>This is the magic guide to rebasing. Picking a commit means it stacks that on for you - that's more-or-less what happens when you pull &amp; rebase. Reword is nice when a typo is bugging you in an old commit. You'll get the option to rewrite the commit message. Squash and fixup are invaluable for local chronic committers.</p><p>If you choose to squash a commit, the changes in that commit will get moved into the previous one. This lets you clean up your history. You might commit changes dozens of times fiddling with things (especially if you have a testing/deployment workflow that involves pushing a branch), but if you're anything like me at least 5 of them are fixing typos or some other simple, boneheaded mistake. Rather than have the stream of 'FZZCKING SHIFt kEy'-style commits, squash them! Try it out on a test repo. Fixup does the same thing, but you'll only see the one commit message in the editor - squash gives you the list. That's helpful if you're like me and tend to do bullets, but only want to highlight the important parts.</p><p>Many group workflows encourage squashing commits to the overall change, rather than all the incremental steps. I like to squash the commits before offering it to merge regardless, as it lets me have a clear history of edits despite the wacky flow I tend to actually use.</p><p>I'm going to skip over exec (and the related <code>--filter-branch</code>) as they're mostly useful for mass edits like scrubbing files or changing user information. If you need to do that kind of thing, <a href="https://git-scm.com/docs/git-filter-branch" target="_blank" rel="external">git-scm</a> has your back at the bottom of the page and <a href="https://help.github.com/articles/remove-sensitive-data/" target="_blank" rel="external">Github has some help too</a>. That's also the majority of answers you'll find on SO and other resources relating to those options.</p><p>Editing commits, however, can be a lot of fun. You get to jump back in time to whenever you wrote the commit and start working on it again, as if you had just hit save. The important thing to remember here is if you want to modify files or the commit message <strong>on the same commit</strong>, you have to use:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="operator"><span class="keyword">commit</span> <span class="comment">--amend</span></span></span><br></pre></td></tr></table></figure><p>Not just <code>git commit</code>. You can, by committing like you usually do, <em>add</em> commits at that point in history (though the time will be off). I encourage you to keep an eye on your <code>git log</code> while you're interactively rebasing, especially if you have several in a row.</p><p>I know what you're thinking: Cool, I can go back and insert a bugfix at a time that makes more sense, and clean up my history; put a README in on the first commit instead of adding it randomly later... But what about those dates? If I mix in commits I don't want to be jumping from April to January to April again. Here's a simple bash script to help you out:</p><figure class="highlight sh"><figcaption><span>Fix commit dates</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIT_COMMITTER_DATE=<span class="string">"`date -d "</span><span class="variable">$1</span><span class="string">"`"</span> git commit --amend --date <span class="string">"`date -d "</span><span class="variable">$1</span><span class="string">"`"</span></span><br></pre></td></tr></table></figure><p>You can save this anywhere on your computer (<code>chmod +x</code>), then run it like <code>./datefix.sh '2015-12-31 23:59:59'</code>. It'll load up your default commit editor and you can add in a Happy New Year message. Similarly, you can change the author/email/etc of any commits this way.</p><p>Play around with it in a repo you haven't made public yet, maybe because the git history is ridiculous. After you rewrite a couple entire histories, you'll feel like a pro at interactive rebasing, and be way more comfortable structuring commits.</p><p>The one <strong>big</strong> caveat (and why I keep recommending not-yet-public repos): You'll totally break merging with other people's records if you go back changing history like this. I always try to keep my work saved separately so I can tweak my commits down later without breaking any collaborator's repos. After playing around with this, though, you should know how to fix it!</p></span></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/2/16/web-application-security-intro/" rel="next" title="Web Application Security Intro"><i class="fa fa-chevron-left"></i> Web Application Security Intro</a></div><div class="post-nav-prev post-nav-item"></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2016</span> <span class="with-love"><i class="icon-next-heart fa fa-beer"></i></span> <span class="author" itemprop="copyrightHolder">jyoko</span></div><div class="powered-by">Powered by <a class="theme-link" href="http://hexo.io">Hexo</a></div><div class="theme-info">Theme - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div></div></footer><div class="back-to-top"></div></div><script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script><script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script><script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script><script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script><script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script><script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script><script type="text/javascript" id="sidebar.toc.highlight">$(document).ready(function(){function o(){$(s+" "+r).removeClass(r.substring(1))}function t(){i(),n()}function i(){var o=$(".sidebar").height()-a.position().top-$(".post-toc-indicator-bottom").height();return a.css("height",o),o}function n(){c(".post-toc-indicator-top",a.scrollTop()>0?"show":"hide"),c(".post-toc-indicator-bottom",a.scrollTop()>=a.find("ol").height()-a.height()?"hide":"show")}function e(o){o.on("mousewheel DOMMouseScroll",function(o){var t=o.originalEvent,i=t.wheelDelta||-t.detail;this.scrollTop+=30*(0>i?1:-1),o.preventDefault(),n()})}function c(o,t){var i=$(o),n="show"===t?1:0;i.velocity?i.velocity("stop").velocity({opacity:n},{duration:100}):i.stop().animate({opacity:n},100)}var s=".post-toc",a=$(s),r=".active-current";a.on("activate.bs.scrollspy",function(){var t=$(s+" .active").last();o(),t.addClass("active-current"),a[0].scrollTop=t.position().top}).on("clear.bs.scrollspy",function(){o()}),$(document).on("sidebar.motion.complete",function(){t()}),$("body").scrollspy({target:s}),$(window).on("resize",function(){$(".sidebar").hasClass("sidebar-active")&&t()}),e(a)});</script><script type="text/javascript" id="sidebar.nav">$(document).ready(function(){var t=$("html"),i=200,a=$.isFunction(t.velocity);$(".sidebar-nav li").on("click",function(){var t=$(this),o="sidebar-nav-active",e="sidebar-panel-active";if(!t.hasClass(o)){var s=$("."+e),n=$("."+t.data("target"));a?s.velocity("transition.slideUpOut",i,function(){n.velocity("stop").velocity("transition.slideDownIn",i).addClass(e)}):s.animate({opacity:0},i,function(){s.hide(),n.stop().css({opacity:0,display:"block"}).animate({opacity:1},i,function(){s.removeClass(e),n.addClass(e)})}),t.siblings().removeClass(o),t.addClass(o)}}),$(".post-toc a").on("click",function(i){i.preventDefault();var o=escapeSelector(this.getAttribute("href")),e=$(o).offset().top;a?t.velocity("stop").velocity("scroll",{offset:e+"px",mobileHA:!1}):$("html, body").stop().animate({scrollTop:e},500)}),motionMiddleWares.sidebar=function(){var t=$(".post-toc-content");"post"===CONFIG.sidebar&&t.length>0&&t.html().trim().length>0&&displaySidebar()}});</script><script type="text/javascript" src="/js/bootstrap.js"></script></body></html>